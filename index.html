<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vinlotto 2025 ðŸ·</title>
  <style>
    :root {
      --wine: #7b1e26;
      --wine-dark: #5e141b;
      --bg: #faf9f7;
      --card: #fff;
      --border: #e2e2e2;
    }
    body {
      margin: 0;
      padding: 20px;
      background: var(--bg);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      color: var(--wine-dark);
      display: flex;
      justify-content: center;
    }
    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 32px;
      width: 100%;
      max-width: 600px;
      text-align: center;
      box-shadow: 0 3px 10px rgba(0,0,0,0.05);
      border: 1px solid var(--border);
    }
    h1 {
      font-size: 1.8rem;
      color: var(--wine-dark);
      margin-bottom: 0.2em;
    }
    p.sub {
      color: #666;
      margin-top: 0;
      margin-bottom: 1.5em;
    }
    #themeBox {
      margin: 20px auto;
      background: #fff5f6;
      border: 2px solid #e8d6d8;
      border-radius: 12px;
      padding: 18px;
      max-width: 420px;
      font-size: 1.1rem;
      color: var(--wine-dark);
      font-weight: 600;
      line-height: 1.6;
    }
    textarea {
      width: 100%;
      min-height: 200px;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 10px;
      font: inherit;
    }
    button {
      cursor: pointer;
      border: none;
      background: var(--wine);
      color: #fff;
      padding: 10px 16px;
      border-radius: 8px;
      font-weight: 600;
      transition: background 0.2s, transform 0.1s;
    }
    button:hover { background: var(--wine-dark); transform: scale(1.02); }
    button.secondary {
      background: #fff;
      color: var(--wine-dark);
      border: 1px solid var(--wine-dark);
    }
    .links { display: grid; gap: 12px; }
    .linkcard {
      background: #f9f8fa;
      border: 1px dashed #ccc;
      border-radius: 10px;
      padding: 14px;
    }
    .pill {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 999px;
      background: #f3e8eb;
      border: 1px solid #e3c6cb;
      font-size: .8em;
      color: var(--wine-dark);
      font-weight: 600;
      margin-bottom: 4px;
    }
    .mono { font-family: ui-monospace, Menlo, Consolas, monospace; word-break: break-all; }
    .muted { color: #666; font-size: .9em; }
    .actions { text-align: center; margin: 16px 0; }
    @media (max-width: 600px) {
      .card { padding: 20px; }
      h1 { font-size: 1.5rem; }
    }
  </style>
</head>
<body>
  <div class="card" id="revealCard" style="display:none">
    <h1>ðŸ‡ Ditt vinomrÃ¥de</h1>
    <p class="sub">Den hÃ¤r sidan visar bara ditt eget omrÃ¥de.</p>
    <div id="themeBox"></div>
  </div>

  <div class="card" id="adminCard">
    <h1>Vinlotto 2025 ðŸ·</h1>
    <p class="sub">20 vinregioner â€“ slumpas till Simon, Isak och William. Var och en fÃ¥r sin egen hemliga lÃ¤nk.</p>
    <p class="sub">Redan besökta vinregioner: </p>
    <p>Piemonte (Italien)</p>
    <p></p>Stellenbosh (Sydafrika)</p>
    <p>Sonoma County (USA)</p>
    <textarea id="themesInput" spellcheck="false"></textarea>

    <div class="actions">
      <button id="genBtn">ðŸŽ² Skapa tre hemliga lÃ¤nkar</button>
    </div>

    <div id="linksBox" class="links">
      <div class="muted" style="text-align:center;">Inga lÃ¤nkar Ã¤nnu.</div>
    </div>
  </div>

<script>
(async function() {
  const qs = s => document.querySelector(s);
  const themesInput = qs('#themesInput');
  const genBtn = qs('#genBtn');
  const linksBox = qs('#linksBox');
  const revealCard = qs('#revealCard');
  const adminCard = qs('#adminCard');
  const themeBox = qs('#themeBox');

  const personNames = ["Simon", "Isak", "William"];
  const defaultThemes = [
    "Barossa Valley, Australien", "Rioja, Spanien", "Mendoza, Argentina", 
    "Bourgogne, Frankrike", "Toscana, Italien", 
    "Priorat, Spanien", "Loire-dalen, Frankrike", "Maipo Valley, Chile", "Douro, Portugal", 
    "Napa Valley, USA", "Alsace, Frankrike", "Veneto, Italien", "Ribera del Duero, Spanien", 
    "RhÃ´ne-dalen, Frankrike", "Marlborough, Nya Zeeland", "Bordeaux, Frankrike"

  ];
  themesInput.value = defaultThemes.join('\n');

  function shuffle(arr) {
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function makeLink(name, theme) {
    const payload = btoa(unescape(encodeURIComponent(JSON.stringify({ name, theme }))));
    const base = window.location.origin + window.location.pathname;
    return base + '#data=' + payload;
  }

  genBtn.addEventListener('click', () => {
    const themes = themesInput.value.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
    const shuffled = shuffle(themes);
    const offset = Math.floor(Math.random() * (themes.length - personNames.length));
    const picked = shuffled.slice(offset, offset + personNames.length);
    linksBox.innerHTML = '';
    picked.forEach((theme, i) => {
      const name = personNames[i];
      const url = makeLink(name, theme);
      const div = document.createElement('div');
      div.className = 'linkcard';
      div.innerHTML = `
        <div><span class="pill">${name}</span></div>
        <div class="mono">${url}</div>
        <div style="margin-top:6px;">
          <button class="secondary" id="copy-${i}">Kopiera</button>
          <a href="${url}" target="_blank"><button>Ã–ppna</button></a>
        </div>`;
      linksBox.appendChild(div);
      div.querySelector(`#copy-${i}`).addEventListener('click', async () => {
        await navigator.clipboard.writeText(url);
        const btn = div.querySelector(`#copy-${i}`);
        btn.textContent = "âœ… Kopierad!";
        btn.disabled = true;
        setTimeout(() => { btn.textContent = "Kopiera"; btn.disabled = false; }, 1500);
      });
    });
  });

  const hash = location.hash.match(/^#data=(.+)$/);
  if (hash) {
    try {
      const decoded = JSON.parse(decodeURIComponent(escape(atob(hash[1]))));
      adminCard.style.display = 'none';
      revealCard.style.display = '';
      themeBox.innerHTML = `
        <p>Tja <b>${decoded.name}</b> ðŸ·</p>
        <p>Din region du ska fÃ¶rdjupa dig inom Ã¤r <b>${decoded.theme}</b>.</p>
        <p>Ska bli riktigt spÃ¤nnande lÃ¤ra sig nya grejer!</p>
      `;
    } catch(e) {
      console.error(e);
    }
  }
})();
</script>
</body>
</html>
